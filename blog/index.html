<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IBRATECH AUTOMATION - Advanced Electrical Solutions</title>
    <link rel="icon" href="../asset/favicon.png" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="contents/ib_styles.css">
    <style>

    </style>

</head>

<body class="bg-gray-50">
    <!-- Sidebar -->
    <div id="sidebar"
        class="fixed left-0 top-0 h-full w-64 bg-white shadow-2xl z-50 sidebar-transition -translate-x-full">
        <div class="p-6 border-b border-gray-100">
            <img src="../asset/logo-ibratech.png"
                alt="IBRATECH" class="h-12 object-contain">
            <p class="text-sm text-gray-500 mt-2">Automation Solutions</p>
        </div>

        <nav class="p-4">
            <a href="../#home"
                class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg mb-2 transition">
                <i class="fas fa-home w-5"></i>
                <span class="ml-3">Home</span>
            </a>
            <a href="../#services"
                class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg mb-2 transition">
                <i class="fas fa-project-diagram w-5"></i>
                <span class="ml-3">Services</span>
            </a>
            <a href="../#system-expertise"
                class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg mb-2 transition">
                <i class="fas fa-network-wired w-5"></i>
                <span class="ml-3">System Expertise</span>
            </a>
            <a href="../#tools"
                class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg mb-2 transition">
                <i class="fas fa-toolbox w-5"></i>
                <span class="ml-3">Products</span>
            </a>
            <a href="../#contact"
                class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg mb-2 transition">
                <i class="fas fa-envelope w-5"></i>
                <span class="ml-3">Contact</span>
            </a>
            <a href="https://wa.me/628117014004?text=Hi%20Ibratech%20Automation%20..."" target=" _blank"
                class="flex items-center px-4 py-3 text-white bg-red-600 hover:bg-red-500 rounded-lg mb-2 transition">
                <i class="fas fa-phone w-5"></i>
                <span class="ml-3">24/7 Response</span>
            </a>
            <hr>
            <a href="#all"
                class="flex items-center px-4 py-3 text-gray-700 bg-blue-50 text-blue-600 rounded-lg mb-2 transition">
                <i class="fas fa-blog w-5"></i>
                <span class="ml-3">Blog</span>
            </a>
        </nav>

        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-100">
            <div class="flex space-x-3 justify-center">
                <a href="#"
                    class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center hover:bg-blue-600 hover:text-white transition">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                <a href="#"
                    class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center hover:bg-blue-600 hover:text-white transition">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="#"
                    class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center hover:bg-blue-600 hover:text-white transition">
                    <i class="fab fa-facebook-f"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Overlay for mobile -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden" onclick="toggleSidebar()"></div>

    <!-- Main Content -->
    <div id="mainContent" class="min-h-screen transition-all duration-300">
        <!-- Top Bar -->
        <div class="bg-white shadow-sm sticky top-0 z-30">
            <div class="px-6 py-4 flex items-center justify-between">
                <button onclick="toggleSidebar()" class="text-gray-700 hover:text-blue-600 transition">
                    <i class="fas fa-bars text-2xl"></i>
                </button>

                <div class="flex items-center space-x-4 ml-auto">
                    <span class="text-sm text-gray-600 hidden md:block">
                        <i class="fas fa-phone-alt text-blue-600 mr-2"></i>
                        Contact: <a href="mailto:contact@ibratech-automation.com"
                            class="text-blue-600 hover:underline">contact@ibratech-automation.com</a>
                    </span>
                </div>
            </div>
        </div>

        <!-- Main Container -->
        <div id="app"></div>
    </div>
    <script src="../contents/ib_script.js"></script>
    <!-- JavaScript -->
    <script>
        let posts = [];

        async function loadPosts() {
            try {
                const response = await fetch('api.php?action=list');
                const data = await response.json();
                posts = data.success ? data.posts : [];
                handleRoute();
            } catch (e) {
                document.getElementById('app').innerHTML = '<div class="text-center py-16"><p class="text-red-600">Error loading posts</p></div>';
            }
        }

        function getGradient(type) {
            const g = {
                'gradient-blue': 'from-blue-600 to-blue-800',
                'gradient-green': 'from-green-600 to-green-800',
                'gradient-red': 'from-red-600 to-red-800',
                'gradient-purple': 'from-purple-600 to-purple-800',
                'gradient-orange': 'from-orange-600 to-orange-800',
                'gradient-indigo': 'from-indigo-600 to-indigo-800',
                'gradient-teal': 'from-teal-600 to-teal-800'
            };
            return g[type] || 'from-gray-600 to-gray-800';
        }

        function getIcon(cat) {
            const icons = {
                'PLC Systems': 'M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z',
                'Electrical Design': 'M13 10V3L4 14h7v7l9-11h-7z',
                'HVAC Solution': 'M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4',
                'default': 'M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z'
            };
            return icons[cat] || icons['default'];
        }

        function renderImage(post, size = 'h-48') {
            const cats = Array.isArray(post.category) ? post.category : [post.category];
            
            if (!post.image || post.image === '') {
                return `<div class="${size} bg-gray-200 flex items-center justify-center">
                    <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                </div>`;
            }
            
            if (post.image.startsWith('http') || post.image.startsWith('uploads/')) {
                return `<div class="${size} overflow-hidden bg-gray-100">
                    <img src="${post.image}" alt="${post.title}" class="w-full h-full object-cover" onerror="this.parentElement.innerHTML='<div class=\\'w-full h-full flex items-center justify-center text-gray-400\\'>Image not found</div>'">
                </div>`;
            }
            
            return `<div class="${size} bg-gradient-to-br ${getGradient(post.image)} flex items-center justify-center">
                <svg class="w-16 h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${getIcon(cats[0])}"></path>
                </svg>
            </div>`;
        }

        function formatDate(d) {
            return new Date(d).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        }

        function stripHtml(html) {
            const tmp = document.createElement('div');
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || '';
        }

        function createCard(post) {
            const cats = Array.isArray(post.category) ? post.category : [post.category];
            const catDisplay = cats.slice(0, 2).map(c => `<span class="text-blue-600 font-medium">${c}</span>`).join(', ');
            const more = cats.length > 2 ? ` +${cats.length - 2}` : '';
            const excerpt = post.excerpt || stripHtml(post.content).substring(0, 150) + '...';
            
            return `<article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300">
                ${renderImage(post)}
                <div class="p-6">
                    <div class="flex items-center gap-2 text-sm text-gray-500 mb-3">
                        <span>${formatDate(post.date)}</span>
                        <span>•</span>
                        ${catDisplay}${more}
                        <!--<span>•</span>
                        <span>${post.readTime}</span>-->
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-3 hover:text-blue-600 transition-colors cursor-pointer" onclick="location.hash='p=${post.id}'">
                        ${post.title}
                    </h3>
                    <p class="text-gray-600 mb-4 line-clamp-3">${excerpt}</p>
                    <div class="flex flex-wrap gap-2 mb-4">
                        ${post.tags.map(t => `<span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">${t}</span>`).join('')}
                    </div>
                    <button onclick="location.hash='p=${post.id}'" class="inline-flex items-center text-blue-600 font-medium hover:text-blue-800 transition-colors">
                        Read More
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>
            </article>`;
        }

        function renderHome() {
            const latest = posts.slice(0, 3);
            document.getElementById('app').innerHTML = `
                <section class="py-16 px-4 md:px-8 lg:px-16">
                    <div class="max-w-7xl mx-auto">
                        <div class="text-center mb-12">
                            <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Latest Insights & Updates</h2>
                            <p class="text-lg text-gray-600 max-w-2xl mx-auto">Discover the latest articles about automation, industrial technology, and engineering solutions</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
                            ${latest.map(p => createCard(p)).join('')}
                        </div>
                        <div class="text-center">
                            <button onclick="location.hash='all'" class="inline-block bg-blue-600 text-white px-8 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors shadow-md hover:shadow-lg">
                                View All Articles
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderAll(filterCat = 'All') {
            const allCats = new Set();
            posts.forEach(p => {
                const cats = Array.isArray(p.category) ? p.category : [p.category];
                cats.forEach(c => allCats.add(c));
            });
            const cats = Array.from(allCats);
            
            const filtered = filterCat === 'All' ? posts : posts.filter(p => {
                const pCats = Array.isArray(p.category) ? p.category : [p.category];
                return pCats.includes(filterCat);
            });

            document.getElementById('app').innerHTML = `
                <section class="py-16 px-4 md:px-8 lg:px-16">
                    <div class="max-w-7xl mx-auto">
                        <div class="text-center mb-12">
                            <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">All Articles</h2>
                            <p class="text-lg text-gray-600 max-w-2xl mx-auto">Browse our complete collection</p>
                        </div>
                        <div class="flex flex-wrap justify-center gap-3 mb-12">
                            <button onclick="location.hash='all'" class="px-4 py-2 rounded-lg font-medium transition-colors ${filterCat === 'All' ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}">All</button>
                            ${cats.map(c => `<button onclick="location.hash='all?category=${encodeURIComponent(c)}'" class="px-4 py-2 rounded-lg font-medium transition-colors ${filterCat === c ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}">${c}</button>`).join('')}
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
                            ${filtered.map(p => createCard(p)).join('')}
                        </div>
                        <div class="text-center">
                            <button onclick="location.hash=''" class="inline-block bg-gray-600 text-white px-8 py-3 rounded-lg font-medium hover:bg-gray-700 transition-colors shadow-md hover:shadow-lg">← Back</button>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderPost(id) {
            const post = posts.find(p => p.id == id);
            if (!post) {
                document.getElementById('app').innerHTML = `<div class="text-center py-16"><p class="text-red-600">Article not found</p><button onclick="location.hash=''" class="mt-4 text-blue-600">← Back</button></div>`;
                return;
            }

            const cats = Array.isArray(post.category) ? post.category : [post.category];
            const related = posts.filter(p => {
                if (p.id == id) return false;
                const pCats = Array.isArray(p.category) ? p.category : [p.category];
                return pCats.some(c => cats.includes(c));
            }).slice(0, 2);

            document.getElementById('app').innerHTML = `
                <article class="py-16 px-4 md:px-8 lg:px-16">
                    <div class="max-w-4xl mx-auto">
                        <button onclick="history.back()" class="mb-8 inline-flex items-center text-gray-600 hover:text-blue-600 transition-colors">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                            Back
                        </button>
                        <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
                            <div class="flex flex-wrap items-center gap-2 text-sm text-gray-600 mb-4">
                                ${cats.map(c => `<span class="px-3 py-1 bg-blue-100 text-blue-600 rounded-full font-medium">${c}</span>`).join('')}
                                <span>${formatDate(post.date)}</span>
                                <!--<span>•</span>
                                <span>${post.readTime}</span>-->
                                <span>•</span>
                                <span>By ${post.author}</span>
                            </div>
                            <h1 class="text-4xl font-bold text-gray-900 mb-6">${post.title}</h1>
                            <div class="flex flex-wrap gap-2 mb-6">
                                ${post.tags.map(t => `<span class="px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded">#${t}</span>`).join('')}
                            </div>
                            ${renderImage(post, 'h-96 rounded-lg')}
                            <div class="article-content text-gray-700 mt-8">${post.content}</div>
                        </div>
                        ${related.length > 0 ? `
                            <div class="mt-12">
                                <h3 class="text-2xl font-bold text-gray-900 mb-6">Related Articles</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    ${related.map(r => createCard(r)).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </article>
            `;
        }

        function handleRoute() {
            const hash = location.hash.slice(1);
            if (!hash) {
                renderHome();
            } else if (hash.startsWith('p=')) {
                renderPost(hash.split('=')[1]);
            } else if (hash.startsWith('all')) {
                const params = new URLSearchParams(hash.split('?')[1] || '');
                renderAll(params.get('category') || 'All');
            } else {
                renderHome();
            }
        }

        window.addEventListener('hashchange', handleRoute);
        loadPosts();
    </script>
</body>
</html>
